<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦–æ¬¡åŠ è½½HTMLæ¸²æŸ“æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-html {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            border-left: 4px solid #007bff;
            font-size: 14px;
        }
        .expected-result {
            background: #d4edda;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #28a745;
            margin-top: 10px;
        }
        .improvement-summary {
            background: #e1f5fe;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
            margin-bottom: 20px;
        }
        .test-instructions {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸš€ é¦–æ¬¡åŠ è½½HTMLæ¸²æŸ“ä¼˜åŒ–æµ‹è¯•</h1>
        
        <div class="improvement-summary">
            <h3>ğŸ¯ æœ¬æ¬¡ä¼˜åŒ–é‡ç‚¹ï¼š</h3>
            <p><strong>é—®é¢˜ï¼š</strong>é¦–æ¬¡æ‰“å¼€é¡µé¢æ—¶HTMLæ¸²æŸ“çª—å£æ˜¾ç¤ºå¾ˆå°ï¼Œåˆ·æ–°åæ‰æ­£å¸¸æ˜¾ç¤ºã€‚</p>
            <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
            <ul>
                <li><strong>å¤šé‡åˆå§‹åŒ–æœºåˆ¶</strong>ï¼šåœ¨ä¸åŒæ—¶æœºè¿›è¡Œå¤šæ¬¡é«˜åº¦è®¡ç®—</li>
                <li><strong>æ›´åˆç†çš„åˆå§‹é«˜åº¦</strong>ï¼šiframeåˆå§‹é«˜åº¦è®¾ä¸º400pxè€Œä¸æ˜¯200px</li>
                <li><strong>å¼ºåˆ¶å¸ƒå±€é‡æ’</strong>ï¼šä½¿ç”¨requestAnimationFrameå’ŒoffsetHeightå¼ºåˆ¶é‡æ–°è®¡ç®—</li>
                <li><strong>é¦–æ¬¡è®¡ç®—ä¼˜åŒ–</strong>ï¼šé¦–æ¬¡è®¡ç®—æ— è¿‡æ¸¡åŠ¨ç”»ï¼Œç«‹å³æ˜¾ç¤ºæ­£ç¡®é«˜åº¦</li>
                <li><strong>å¢åŠ è®¡ç®—æ¬¡æ•°</strong>ï¼šä»3æ¬¡å¢åŠ åˆ°8æ¬¡ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿæœºä¼šè·å¾—æ­£ç¡®ç»“æœ</li>
            </ul>
        </div>

        <div class="test-instructions">
            <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤ï¼š</h3>
            <ol>
                <li><strong>å…³é”®æµ‹è¯•</strong>ï¼šåœ¨æ–°çš„æµè§ˆå™¨æ ‡ç­¾é¡µä¸­æ‰“å¼€æ­¤é¡µé¢ï¼ˆæ¨¡æ‹Ÿé¦–æ¬¡è®¿é—®ï¼‰</li>
                <li><strong>è§‚å¯Ÿåˆå§‹æ˜¾ç¤º</strong>ï¼šæ³¨æ„HTMLæ¸²æŸ“çª—å£çš„åˆå§‹å¤§å°æ˜¯å¦åˆç†</li>
                <li><strong>æ£€æŸ¥æ§åˆ¶å°</strong>ï¼šè§‚çœ‹é«˜åº¦è®¡ç®—çš„æ—¥å¿—ä¿¡æ¯</li>
                <li><strong>ä¸è¦åˆ·æ–°</strong>ï¼šåº”è¯¥åœ¨é¦–æ¬¡åŠ è½½æ—¶å°±æ˜¾ç¤ºæ­£ç¡®çš„é«˜åº¦</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>æµ‹è¯•1ï¼šçŸ­å†…å®¹é¦–æ¬¡åŠ è½½</h2>
            <div class="test-html"><!-- render:true -->
&lt;div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;"&gt;
    &lt;h3&gt;é¦–æ¬¡åŠ è½½æµ‹è¯•&lt;/h3&gt;
    &lt;p&gt;è¿™ä¸ªå†…å®¹åº”è¯¥åœ¨é¦–æ¬¡æ‰“å¼€é¡µé¢æ—¶å°±æ˜¾ç¤ºæ­£ç¡®çš„é«˜åº¦ï¼&lt;/p&gt;
    &lt;p&gt;å¦‚æœä½ çœ‹åˆ°è¿™ä¸ªçª—å£çš„é«˜åº¦æ˜¯åˆé€‚çš„ï¼Œè¯´æ˜ä¼˜åŒ–æˆåŠŸã€‚&lt;/p&gt;
&lt;/div&gt;</div>
            <div class="expected-result">
                <strong>æœŸæœ›ç»“æœï¼š</strong>é¦–æ¬¡æ‰“å¼€é¡µé¢æ—¶å°±åº”è¯¥æ˜¾ç¤ºåˆé€‚çš„é«˜åº¦ï¼Œä¸éœ€è¦åˆ·æ–°é¡µé¢
            </div>
        </div>

        <div class="test-section">
            <h2>æµ‹è¯•2ï¼šä¸­ç­‰å†…å®¹é¦–æ¬¡åŠ è½½</h2>
            <div class="test-html"><!-- render:true -->
&lt;div style="padding: 20px; border: 2px solid #e74c3c; border-radius: 10px; font-family: Arial, sans-serif;"&gt;
    &lt;h2 style="color: #e74c3c; margin-top: 0;"&gt;ä¸­ç­‰é•¿åº¦å†…å®¹æµ‹è¯•&lt;/h2&gt;
    &lt;p&gt;è¿™æ˜¯ä¸€ä¸ªåŒ…å«æ›´å¤šå†…å®¹çš„æµ‹è¯•æ¡ˆä¾‹ï¼Œç”¨æ¥éªŒè¯é¦–æ¬¡åŠ è½½æ—¶çš„é«˜åº¦è®¡ç®—æ˜¯å¦å‡†ç¡®ã€‚&lt;/p&gt;
    
    &lt;h3&gt;ä¼˜åŒ–å†…å®¹è¯´æ˜&lt;/h3&gt;
    &lt;ul&gt;
        &lt;li&gt;å¤šé‡åˆå§‹åŒ–ï¼š10msã€100msã€300msã€600mså¤šä¸ªæ—¶æœºè®¡ç®—&lt;/li&gt;
        &lt;li&gt;å¼ºåˆ¶é‡æ’ï¼šä½¿ç”¨offsetHeightå¼ºåˆ¶æµè§ˆå™¨é‡æ–°è®¡ç®—å¸ƒå±€&lt;/li&gt;
        &lt;li&gt;requestAnimationFrameï¼šç­‰å¾…æµè§ˆå™¨ä¸‹ä¸€å¸§å†è®¡ç®—&lt;/li&gt;
        &lt;li&gt;åˆå§‹é«˜åº¦ï¼šè®¾ç½®400pxåˆç†çš„èµ·å§‹é«˜åº¦&lt;/li&gt;
    &lt;/ul&gt;
    
    &lt;h3&gt;æµ‹è¯•è¦ç‚¹&lt;/h3&gt;
    &lt;p&gt;âœ… é¦–æ¬¡æ‰“å¼€é¡µé¢å°±åº”è¯¥çœ‹åˆ°æ­£ç¡®çš„é«˜åº¦&lt;/p&gt;
    &lt;p&gt;âœ… ä¸éœ€è¦åˆ·æ–°é¡µé¢&lt;/p&gt;
    &lt;p&gt;âœ… æ§åˆ¶å°æ˜¾ç¤ºå¤šæ¬¡è®¡ç®—æ—¥å¿—&lt;/p&gt;
    &lt;p&gt;âœ… é¦–æ¬¡è®¡ç®—æ ‡è®°ä¸ºisFirstCalculation: true&lt;/p&gt;
&lt;/div&gt;</div>
            <div class="expected-result">
                <strong>æœŸæœ›ç»“æœï¼š</strong>ä¸­ç­‰é•¿åº¦çš„å†…å®¹ä¹Ÿåº”è¯¥åœ¨é¦–æ¬¡åŠ è½½æ—¶å°±æ­£ç¡®æ˜¾ç¤ºï¼Œçª—å£é«˜åº¦é€‚åˆå†…å®¹
            </div>
        </div>

        <div class="test-section">
            <h2>æµ‹è¯•3ï¼šè¾ƒé•¿å†…å®¹é¦–æ¬¡åŠ è½½ï¼ˆå…³é”®æµ‹è¯•ï¼‰</h2>
            <div class="test-html"><!-- render:true -->
&lt;div style="padding: 25px; border: 3px solid #f39c12; border-radius: 12px; background: #fdf6e3;"&gt;
    &lt;h1 style="color: #f39c12; text-align: center; margin-top: 0;"&gt;ğŸ¯ é¦–æ¬¡åŠ è½½é•¿å†…å®¹æµ‹è¯•&lt;/h1&gt;
    
    &lt;div style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white; padding: 15px; border-radius: 8px; margin: 15px 0;"&gt;
        &lt;h2&gt;è¿™æ˜¯æœ€é‡è¦çš„æµ‹è¯•ï¼&lt;/h2&gt;
        &lt;p&gt;å¦‚æœè¿™ä¸ªè¾ƒé•¿çš„å†…å®¹åœ¨é¦–æ¬¡åŠ è½½æ—¶å°±èƒ½å®Œæ•´æ˜¾ç¤ºï¼Œè¯´æ˜æˆ‘ä»¬çš„ä¼˜åŒ–å®Œå…¨æˆåŠŸäº†ã€‚&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;h2&gt;ä¼˜åŒ–æœºåˆ¶è¯¦è§£&lt;/h2&gt;
    
    &lt;h3&gt;1. å¤šæ—¶æœºåˆå§‹åŒ–&lt;/h3&gt;
    &lt;p&gt;æˆ‘ä»¬åœ¨ä»¥ä¸‹å¤šä¸ªæ—¶æœºè¿›è¡Œé«˜åº¦è®¡ç®—ï¼š&lt;/p&gt;
    &lt;ul&gt;
        &lt;li&gt;&lt;strong&gt;ç«‹å³è®¡ç®—&lt;/strong&gt; (10ms)ï¼šå°½å¿«è·å¾—ä¸€ä¸ªåˆå§‹é«˜åº¦&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;DOMå‡†å¤‡å&lt;/strong&gt; (100ms)ï¼šç­‰å¾…DOMå†…å®¹ç¨³å®š&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;æ ·å¼åº”ç”¨å&lt;/strong&gt; (300ms)ï¼šç­‰å¾…CSSæ ·å¼å®Œå…¨ç”Ÿæ•ˆ&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;æœ€ç»ˆç¡®è®¤&lt;/strong&gt; (600ms)ï¼šè¿›è¡Œæœ€ç»ˆçš„é«˜åº¦ç¡®è®¤&lt;/li&gt;
    &lt;/ul&gt;
    
    &lt;h3&gt;2. å¼ºåˆ¶å¸ƒå±€é‡æ’&lt;/h3&gt;
    &lt;p&gt;é€šè¿‡è®¿é—®offsetHeightå±æ€§å¼ºåˆ¶æµè§ˆå™¨é‡æ–°è®¡ç®—å¸ƒå±€ï¼Œç¡®ä¿è·å¾—å‡†ç¡®çš„é«˜åº¦å€¼ã€‚&lt;/p&gt;
    
    &lt;h3&gt;3. requestAnimationFrameä¼˜åŒ–&lt;/h3&gt;
    &lt;p&gt;ä½¿ç”¨requestAnimationFrameç¡®ä¿åœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜æ—¶è®¡ç®—é«˜åº¦ï¼Œæé«˜å‡†ç¡®æ€§ã€‚&lt;/p&gt;
    
    &lt;h3&gt;4. æ™ºèƒ½è¾¹è·è®¡ç®—&lt;/h3&gt;
    &lt;p&gt;æ·»åŠ 30pxçš„è¾¹è·ç¡®ä¿å†…å®¹ä¸ä¼šè¢«æˆªæ–­ï¼ŒåŒæ—¶ä¸ä¼šè¿‡åº¦å¢åŠ é«˜åº¦ã€‚&lt;/p&gt;
    
    &lt;h3&gt;5. é¦–æ¬¡è®¡ç®—ç‰¹æ®Šå¤„ç†&lt;/h3&gt;
    &lt;p&gt;å¯¹äºé¦–æ¬¡è®¡ç®—ç»“æœï¼Œç«‹å³åº”ç”¨é«˜åº¦å˜åŒ–ï¼ˆæ— åŠ¨ç”»ï¼‰ï¼Œç¡®ä¿ç”¨æˆ·çœ‹åˆ°æ­£ç¡®çš„åˆå§‹å¤§å°ã€‚&lt;/p&gt;
    
    &lt;div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #27ae60;"&gt;
        &lt;h3 style="color: #27ae60; margin-top: 0;"&gt;âœ… æˆåŠŸæŒ‡æ ‡&lt;/h3&gt;
        &lt;p&gt;å¦‚æœä½ èƒ½åœ¨é¦–æ¬¡æ‰“å¼€é¡µé¢æ—¶å°±çœ‹åˆ°è¿™æ•´ä¸ªç»¿è‰²åŒºåŸŸï¼Œè¯´æ˜ä¼˜åŒ–å®Œå…¨æˆåŠŸï¼&lt;/p&gt;
        &lt;p&gt;è¿™æ„å‘³ç€ï¼š&lt;/p&gt;
        &lt;ul&gt;
            &lt;li&gt;iframeé«˜åº¦è®¡ç®—æ­£ç¡®&lt;/li&gt;
            &lt;li&gt;å¤šé‡åˆå§‹åŒ–æœºåˆ¶æœ‰æ•ˆ&lt;/li&gt;
            &lt;li&gt;ä¸å†éœ€è¦åˆ·æ–°é¡µé¢&lt;/li&gt;
            &lt;li&gt;ç”¨æˆ·ä½“éªŒå¾—åˆ°æ˜¾è‘—æ”¹å–„&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
    
    &lt;h3&gt;è°ƒè¯•ä¿¡æ¯&lt;/h3&gt;
    &lt;p&gt;è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼Œåº”è¯¥èƒ½çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š&lt;/p&gt;
    &lt;ul&gt;
        &lt;li&gt;"HTMLæ¸²æŸ“: ç«‹å³è®¡ç®—é«˜åº¦ (é¦–æ¬¡å°è¯•)"&lt;/li&gt;
        &lt;li&gt;"HTMLæ¸²æŸ“: DOMå†…å®¹å‡†å¤‡åè®¡ç®—"&lt;/li&gt;
        &lt;li&gt;"HTMLæ¸²æŸ“é«˜åº¦è®¡ç®— (ç²¾ç¡®æ¨¡å¼)" - isFirstCalculation: true&lt;/li&gt;
        &lt;li&gt;"HTMLæ¸²æŸ“: è°ƒæ•´iframeé«˜åº¦ (å®Œæ•´æ˜¾ç¤ºæ¨¡å¼)" - isFirstCalculation: true&lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;</div>
            <div class="expected-result">
                <strong>æœŸæœ›ç»“æœï¼š</strong>è¿™æ˜¯å…³é”®æµ‹è¯•ï¼è¾ƒé•¿çš„å†…å®¹åº”è¯¥åœ¨é¦–æ¬¡åŠ è½½æ—¶å°±å®Œæ•´æ˜¾ç¤ºï¼Œè¯æ˜ä¼˜åŒ–æˆåŠŸ
            </div>
        </div>

        <div style="margin-top: 50px; padding: 20px; background: #f0f8f0; border-radius: 8px; text-align: center;">
            <h2>ğŸ‰ æµ‹è¯•å®Œæˆ</h2>
            <p><strong>å¦‚æœä¸Šé¢æ‰€æœ‰çš„HTMLå†…å®¹éƒ½èƒ½åœ¨é¦–æ¬¡æ‰“å¼€é¡µé¢æ—¶æ­£ç¡®æ˜¾ç¤ºé«˜åº¦ï¼Œæ­å–œï¼ä¼˜åŒ–æˆåŠŸï¼</strong></p>
            <p>ç°åœ¨ç”¨æˆ·ä¸å†éœ€è¦åˆ·æ–°é¡µé¢å°±èƒ½çœ‹åˆ°æ­£ç¡®å¤§å°çš„HTMLæ¸²æŸ“çª—å£äº†ã€‚</p>
            <p>é¡µé¢åŠ è½½æ—¶é—´ï¼š<span id="loadTime"></span></p>
        </div>
    </div>

    <script>
        // è®°å½•é¡µé¢åŠ è½½æ—¶é—´
        const startTime = performance.now();
        
        window.addEventListener('load', () => {
            const loadTime = (performance.now() - startTime).toFixed(2);
            document.getElementById('loadTime').textContent = loadTime + 'ms';
            
            console.log('ğŸ¯ é¦–æ¬¡åŠ è½½æµ‹è¯•é¡µé¢å·²å®ŒæˆåŠ è½½');
            console.log('åŠ è½½æ—¶é—´:', loadTime + 'ms');
            
            // ç›‘æ§iframeé«˜åº¦å˜åŒ–
            setTimeout(() => {
                const iframes = document.querySelectorAll('iframe.html-render-iframe');
                iframes.forEach((iframe, index) => {
                    console.log(`iframe ${index + 1} å½“å‰é«˜åº¦:`, iframe.style.height);
                });
                
                if (iframes.length === 0) {
                    console.log('âš ï¸ æœªæ‰¾åˆ°HTMLæ¸²æŸ“iframeï¼Œå¯èƒ½æ¸²æŸ“åŠŸèƒ½æœªå¯ç”¨');
                } else {
                    console.log('âœ… æ‰¾åˆ°', iframes.length, 'ä¸ªHTMLæ¸²æŸ“iframe');
                }
            }, 2000);
        });
        
        // ç›‘å¬iframeé«˜åº¦è°ƒæ•´æ¶ˆæ¯
        let heightAdjustmentCount = 0;
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'htmlRenderAccurateResize') {
                heightAdjustmentCount++;
                console.log(`ğŸ“ ç¬¬${heightAdjustmentCount}æ¬¡é«˜åº¦è°ƒæ•´:`, {
                    height: event.data.height + 'px',
                    isFirstCalculation: event.data.isFirstCalculation,
                    calculationAttempt: event.data.calculationAttempt,
                    timestamp: new Date(event.data.timestamp).toLocaleTimeString()
                });
                
                if (event.data.isFirstCalculation) {
                    console.log('ğŸ‰ é¦–æ¬¡è®¡ç®—å®Œæˆï¼é«˜åº¦åº”è¯¥ç«‹å³æ›´æ–°ä¸º:', event.data.height + 'px');
                }
            }
        });
    </script>
</body>
</html>